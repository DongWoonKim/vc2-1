name: ì´ìŠˆ ë¼ë²¨ ìë™ ë“±ë¡

on:
  issues:
    types: [opened, reopened]

jobs:
  label:
    runs-on: ubuntu-latest
    permissions:
      issues: write
      contents: read
      
    steps:
    - uses: actions/checkout@v4
    
    - name: ì´ìŠˆ ë¶„ì„ ë° ë¼ë²¨ ê²°ì •
      id: analyze
      run: |
        title="${{ github.event.issue.title }}"
        body="${{ github.event.issue.body }}"
        
        # ì´ìŠˆ íƒ€ì… ë¼ë²¨
        if echo "$title" | grep -qi "^\[bug\]\|\bbug\b"; then
          echo "type_bug=true" >> $GITHUB_OUTPUT
        elif echo "$title" | grep -qi "^\[feature\]\|\bfeature\b"; then
          echo "type_feature=true" >> $GITHUB_OUTPUT
        elif echo "$title" | grep -qi "^\[question\]\|\bquestion\b"; then
          echo "type_question=true" >> $GITHUB_OUTPUT
        elif echo "$title" | grep -qi "^\[enhancement\]\|\benhancement\b"; then
          echo "type_enhancement=true" >> $GITHUB_OUTPUT
        elif echo "$title" | grep -qi "^\[docs\]\|\bdocs\b\|\bdocumentation\b"; then
          echo "type_documentation=true" >> $GITHUB_OUTPUT
        fi
        
        # ìš°ì„ ìˆœìœ„ ë¼ë²¨
        if echo "$title $body" | grep -qi "urgent\|critical\|ë¸”ë¡œí‚¹\|ê¸´ê¸‰\|ì‹¬ê°"; then
          echo "priority=critical" >> $GITHUB_OUTPUT
        elif echo "$title $body" | grep -qi "important\|ì¤‘ìš”\|ë¹ ë¥¸"; then
          echo "priority=high" >> $GITHUB_OUTPUT
        elif echo "$title $body" | grep -qi "normal\|ì¼ë°˜"; then
          echo "priority=medium" >> $GITHUB_OUTPUT
        else
          echo "priority=low" >> $GITHUB_OUTPUT
        fi
        
        # ì»´í¬ë„ŒíŠ¸ ë¼ë²¨
        if echo "$title $body" | grep -qi "backend\|api\|server\|fastapi\|langraph"; then
          echo "component_backend=true" >> $GITHUB_OUTPUT
        fi
        if echo "$title $body" | grep -qi "frontend\|ui\|streamlit\|interface"; then
          echo "component_frontend=true" >> $GITHUB_OUTPUT
        fi
        if echo "$title $body" | grep -qi "docs\|documentation\|readme\|guide"; then
          echo "component_docs=true" >> $GITHUB_OUTPUT
        fi
        
        # ë‚œì´ë„ ì¶”ì •
        if echo "$title $body" | grep -qi "easy\|simple\|ì‰¬ìš´\|ê°„ë‹¨"; then
          echo "difficulty=easy" >> $GITHUB_OUTPUT
        elif echo "$title $body" | grep -qi "hard\|complex\|ì–´ë ¤ìš´\|ë³µì¡"; then
          echo "difficulty=hard" >> $GITHUB_OUTPUT
        else
          echo "difficulty=medium" >> $GITHUB_OUTPUT
        fi
        
    - name: ë¼ë²¨ ì ìš©
      uses: actions/github-script@v7
      with:
        script: |
          const labels = [];
          
          // íƒ€ì… ë¼ë²¨
          if ('${{ steps.analyze.outputs.type_bug }}' === 'true') {
            labels.push('type/bug');
          }
          if ('${{ steps.analyze.outputs.type_feature }}' === 'true') {
            labels.push('type/feature');
          }
          if ('${{ steps.analyze.outputs.type_question }}' === 'true') {
            labels.push('type/question');
          }
          if ('${{ steps.analyze.outputs.type_enhancement }}' === 'true') {
            labels.push('type/enhancement');
          }
          if ('${{ steps.analyze.outputs.type_documentation }}' === 'true') {
            labels.push('type/documentation');
          }
          
          // ìš°ì„ ìˆœìœ„ ë¼ë²¨
          const priority = '${{ steps.analyze.outputs.priority }}';
          labels.push(`priority/${priority}`);
          
          // ì»´í¬ë„ŒíŠ¸ ë¼ë²¨
          if ('${{ steps.analyze.outputs.component_backend }}' === 'true') {
            labels.push('component/backend');
          }
          if ('${{ steps.analyze.outputs.component_frontend }}' === 'true') {
            labels.push('component/frontend');
          }
          if ('${{ steps.analyze.outputs.component_docs }}' === 'true') {
            labels.push('component/docs');
          }
          
          // ë‚œì´ë„ ë¼ë²¨
          const difficulty = '${{ steps.analyze.outputs.difficulty }}';
          labels.push(`difficulty/${difficulty}`);
          
          // ìƒíƒœ ë¼ë²¨
          labels.push('status/open');
          
          console.log('ì ìš©í•  ë¼ë²¨:', labels);
          
          // ë¼ë²¨ ì ìš©
          if (labels.length > 0) {
            await github.rest.issues.addLabels({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: context.issue.number,
              labels: labels
            });
          }
          
          // ë¼ë²¨ ì ìš© ì™„ë£Œ ëŒ“ê¸€
          const comment = `## ğŸ·ï¸ ìë™ ë¼ë²¨ë§ ì™„ë£Œ
          
          **ì ìš©ëœ ë¼ë²¨**: ${labels.map(l => `\`${l}\``).join(', ')}
          
          **ë¼ë²¨ ì„¤ëª…**:
          - **íƒ€ì…**: ì´ìŠˆì˜ ì¢…ë¥˜ (bug, feature, question ë“±)
          - **ìš°ì„ ìˆœìœ„**: ì²˜ë¦¬ ìš°ì„ ìˆœìœ„ (critical, high, medium, low)
          - **ì»´í¬ë„ŒíŠ¸**: ê´€ë ¨ ì»´í¬ë„ŒíŠ¸ (backend, frontend, docs)
          - **ë‚œì´ë„**: ì˜ˆìƒ êµ¬í˜„ ë‚œì´ë„ (easy, medium, hard)
          - **ìƒíƒœ**: í˜„ì¬ ì§„í–‰ ìƒíƒœ (open, in-progress, resolved)
          
          ---
          *ë¼ë²¨ì€ ì´ìŠˆ ë‚´ìš©ì„ ê¸°ë°˜ìœ¼ë¡œ ìë™ ë¶„ì„ë˜ì—ˆìŠµë‹ˆë‹¤. í•„ìš”ì‹œ ìˆ˜ë™ìœ¼ë¡œ ìˆ˜ì • ê°€ëŠ¥í•©ë‹ˆë‹¤.*`;
          
          await github.rest.issues.createComment({
            issue_number: context.issue.number,
            owner: context.repo.owner,
            repo: context.repo.repo,
            body: comment
          }); 