name: PR ìë™ í• ë‹¹

on:
  pull_request:
    types: [opened, reopened]

jobs:
  assign:
    runs-on: ubuntu-latest
    permissions:
      pull-requests: write
      contents: read
      
    steps:
    - uses: actions/checkout@v4
      with:
        fetch-depth: 0
    
    - name: ë³€ê²½ëœ íŒŒì¼ ë¶„ì„
      id: analyze
      run: |
        echo "Changed files:"
        git fetch origin ${{ github.base_ref }}
        git diff --name-only origin/${{ github.base_ref }}...HEAD
        
        # ì»´í¬ë„ŒíŠ¸ë³„ ë‹´ë‹¹ì ê²°ì •
        if git diff --name-only origin/${{ github.base_ref }}...HEAD | grep -q "^backend/"; then
          echo "assignee=backend-team" >> $GITHUB_OUTPUT
          echo "component=backend" >> $GITHUB_OUTPUT
        elif git diff --name-only origin/${{ github.base_ref }}...HEAD | grep -q "^frontend/"; then
          echo "assignee=frontend-team" >> $GITHUB_OUTPUT
          echo "component=frontend" >> $GITHUB_OUTPUT
        elif git diff --name-only origin/${{ github.base_ref }}...HEAD | grep -q "\.md$\|^docs/"; then
          echo "assignee=docs-team" >> $GITHUB_OUTPUT
          echo "component=docs" >> $GITHUB_OUTPUT
        else
          echo "assignee=maintainer" >> $GITHUB_OUTPUT
          echo "component=general" >> $GITHUB_OUTPUT
        fi
        
    - name: PR í• ë‹¹
      uses: actions/github-script@v7
      with:
        script: |
          const component = '${{ steps.analyze.outputs.component }}';
          const assigneeMap = {
            'backend': ['${{ github.repository_owner }}'], // ì‹¤ì œ íŒ€ì› GitHub ì•„ì´ë””ë¡œ ë³€ê²½
            'frontend': ['${{ github.repository_owner }}'], // ì‹¤ì œ íŒ€ì› GitHub ì•„ì´ë””ë¡œ ë³€ê²½
            'docs': ['${{ github.repository_owner }}'], // ì‹¤ì œ íŒ€ì› GitHub ì•„ì´ë””ë¡œ ë³€ê²½
            'general': ['${{ github.repository_owner }}'] // ì‹¤ì œ ë©”ì¸í…Œì´ë„ˆ GitHub ì•„ì´ë””ë¡œ ë³€ê²½
          };
          
          const assignees = assigneeMap[component] || assigneeMap['general'];
          
          // PR í• ë‹¹
          try {
            await github.rest.issues.addAssignees({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: context.issue.number,
              assignees: assignees
            });
            
            console.log(`PRì´ ${assignees.join(', ')}ì—ê²Œ í• ë‹¹ë˜ì—ˆìŠµë‹ˆë‹¤.`);
          } catch (error) {
            console.log(`í• ë‹¹ ì‹¤íŒ¨: ${error.message}`);
          }
          
          // ëŒ“ê¸€ë¡œ í• ë‹¹ ì •ë³´ ì•Œë¦¼
          const comment = `## ğŸ¯ ìë™ í• ë‹¹ ì™„ë£Œ
          
          **ì»´í¬ë„ŒíŠ¸**: ${component}
          **í• ë‹¹ì**: ${assignees.map(a => `@${a}`).join(', ')}
          
          ---
          *ì´ PRì€ ë³€ê²½ëœ íŒŒì¼ì„ ê¸°ë°˜ìœ¼ë¡œ ìë™ í• ë‹¹ë˜ì—ˆìŠµë‹ˆë‹¤.*`;
          
          await github.rest.issues.createComment({
            issue_number: context.issue.number,
            owner: context.repo.owner,
            repo: context.repo.repo,
            body: comment
          }); 